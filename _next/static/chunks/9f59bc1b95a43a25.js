(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3285,e=>{"use strict";let i=[{name:"OT",label:"Ordre de Travail",description:"Table principale des ordres de travail"},{name:"OTDetail",label:"DÃ©tail OT",description:"Lignes de dÃ©tail des ordres de travail"},{name:"OT_Packages",label:"Colis OT",description:"Colis associÃ©s aux ordres de travail"},{name:"PLANS",label:"Plans",description:"Planification des livraisons"},{name:"CLIENTS",label:"Clients",description:"Table des clients"},{name:"STAFF",label:"Personnel",description:"Table du personnel"}],t={OT:[{name:"status",label:"Statut",type:"string",possibleValues:["DRAFT","PLANNED","IN_PROGRESS","DELIVERED","CANCELLED"]},{name:"delivery_date",label:"Date de livraison",type:"date"},{name:"client_id",label:"ID Client",type:"string"},{name:"priority",label:"PrioritÃ©",type:"number"},{name:"is_urgent",label:"Urgent",type:"boolean"}],OTDetail:[{name:"quantity",label:"QuantitÃ©",type:"number"},{name:"product_code",label:"Code Produit",type:"string"},{name:"status",label:"Statut",type:"string",possibleValues:["PENDING","PICKED","PACKED"]}],OT_Packages:[{name:"package_status",label:"Statut Colis",type:"string",possibleValues:["CREATED","SHIPPED","DELIVERED"]},{name:"weight",label:"Poids",type:"number"},{name:"tracking_number",label:"NumÃ©ro de suivi",type:"string"}],PLANS:[{name:"plan_date",label:"Date du plan",type:"date"},{name:"driver_id",label:"ID Chauffeur",type:"string"},{name:"status",label:"Statut",type:"string",possibleValues:["DRAFT","CONFIRMED","COMPLETED"]}],CLIENTS:[{name:"name",label:"Nom",type:"string"},{name:"email",label:"Email",type:"string"},{name:"is_active",label:"Actif",type:"boolean"}],STAFF:[{name:"name",label:"Nom",type:"string"},{name:"role",label:"RÃ´le",type:"string"},{name:"email",label:"Email",type:"string"}]},a=[{id:"comm1",name:"Notification Livraison PlanifiÃ©e",description:"Informe le client que sa livraison est planifiÃ©e",channels:["email","sms"],recipientType:"final_client",recipientDetails:"Client final liÃ© Ã  l'OT",frequency:"once",subject:"Votre livraison est planifiÃ©e",bodyPreview:"Bonjour {{client_name}}, votre commande sera livrÃ©e le {{delivery_date}}...",attachments:["Bon de livraison"],createdAt:"2024-01-10T09:00:00Z",createdBy:"Jean Directeur"},{id:"comm2",name:"Confirmation de Livraison",description:"Confirme que la livraison a Ã©tÃ© effectuÃ©e",channels:["email"],recipientType:"final_client",recipientDetails:"Client final liÃ© Ã  l'OT",frequency:"once",subject:"Livraison effectuÃ©e",bodyPreview:"Bonjour {{client_name}}, votre commande a Ã©tÃ© livrÃ©e avec succÃ¨s...",attachments:["Preuve de livraison","Facture"],createdAt:"2024-01-12T14:00:00Z",createdBy:"Marie Admin"},{id:"comm3",name:"Alerte Retard Livraison",description:"Alerte le gestionnaire en cas de retard",channels:["email","whatsapp"],recipientType:"role",recipientDetails:"Gestionnaires",frequency:"once",subject:"Alerte: Retard de livraison",bodyPreview:"Attention, l'OT {{ot_id}} est en retard de livraison...",attachments:[],createdAt:"2024-01-15T10:00:00Z",createdBy:"Admin SystÃ¨me"},{id:"comm4",name:"Rapport Quotidien",description:"Rapport quotidien des opÃ©rations",channels:["email"],recipientType:"staff",recipientDetails:"Tout le personnel",frequency:"daily",subject:"Rapport du {{date}}",bodyPreview:"Voici le rÃ©sumÃ© des opÃ©rations du jour...",attachments:["Rapport PDF"],createdAt:"2024-01-08T08:00:00Z",createdBy:"Jean Directeur"}];async function n(){return await new Promise(e=>setTimeout(e,300)),i}async function s(e){return await new Promise(e=>setTimeout(e,300)),t[e]||[]}async function l(){return await new Promise(e=>setTimeout(e,400)),a}async function r(e){return await new Promise(e=>setTimeout(e,800)),console.log("Creating automatic rule:",JSON.stringify(e,null,2)),{id:Date.now().toString()}}async function c(e){let i=[];return e.name.trim()||i.push("Le nom de la rÃ¨gle est requis"),e.trigger.tableName||i.push("SÃ©lectionnez une table source"),e.trigger.event||i.push("SÃ©lectionnez un type d'Ã©vÃ©nement"),e.communicationId||i.push("SÃ©lectionnez une communication"),i}let d=[{id:"rule1",name:"Notification OT PlanifiÃ©",isActive:!0,trigger:{table:"OT",event:"update",field:"status",fromValue:"DRAFT",toValue:"PLANNED"},linkedCommunication:{id:"comm1",name:"Notification Livraison PlanifiÃ©e",channels:["email","sms"]},schedule:{type:"immediate"},createdAt:"2024-01-15T10:00:00Z"},{id:"rule2",name:"Confirmation Livraison EffectuÃ©e",isActive:!0,trigger:{table:"OT",event:"update",field:"status",toValue:"DELIVERED"},linkedCommunication:{id:"comm2",name:"Confirmation de Livraison",channels:["email"]},schedule:{type:"delayed",expression:"15 min"},createdAt:"2024-01-16T14:00:00Z"},{id:"rule3",name:"Alerte Colis ExpÃ©diÃ©",isActive:!1,trigger:{table:"OT_Packages",event:"update",field:"package_status",toValue:"SHIPPED"},linkedCommunication:{id:"comm1",name:"Notification Livraison PlanifiÃ©e",channels:["email","sms"]},schedule:{type:"immediate"},createdAt:"2024-01-17T09:00:00Z"},{id:"rule4",name:"Rapport Quotidien Automatique",isActive:!0,trigger:{table:"PLANS",event:"create"},linkedCommunication:{id:"comm4",name:"Rapport Quotidien",channels:["email"]},schedule:{type:"cron",expression:"0 18 * * *"},createdAt:"2024-01-10T08:00:00Z"},{id:"rule5",name:"Alerte Retard Livraison",isActive:!0,trigger:{table:"OT",event:"update",field:"status",toValue:"CANCELLED"},linkedCommunication:{id:"comm3",name:"Alerte Retard Livraison",channels:["email","whatsapp"]},schedule:{type:"immediate"},createdAt:"2024-01-18T11:00:00Z"}];async function o(){return await new Promise(e=>setTimeout(e,400)),[...d]}async function m(e){await new Promise(e=>setTimeout(e,300));let i=d.find(i=>i.id===e);if(!i)throw Error("Rule not found");return i.isActive=!i.isActive,{...i}}async function u(e){await new Promise(e=>setTimeout(e,300));let i=d.findIndex(i=>i.id===e);-1!==i&&d.splice(i,1)}async function p(e){return await new Promise(e=>setTimeout(e,300)),d.find(i=>i.id===e)||null}e.s(["createRule",()=>r,"deleteRule",()=>u,"fetchAvailableTables",()=>n,"fetchCommunications",()=>l,"fetchTableFields",()=>s,"getRuleById",()=>p,"getRules",()=>o,"toggleRuleStatus",()=>m,"validateRule",()=>c])},54635,e=>{"use strict";var i=e.i(43476);function t({isActive:e}){return(0,i.jsxs)("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${e?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:[(0,i.jsx)("span",{className:`w-2 h-2 rounded-full ${e?"bg-green-500":"bg-gray-400"}`}),e?"Active":"Inactive"]})}e.s(["RuleStatusBadge",()=>t])},60836,e=>{"use strict";var i=e.i(43476),t=e.i(71645),a=e.i(18566),n=e.i(22016),s=e.i(3285),l=e.i(54635);let r={email:"ðŸ“§ Email",sms:"ðŸ“± SMS",whatsapp:"ðŸ’¬ WhatsApp"},c={immediate:"ImmÃ©diat",delayed:"DiffÃ©rÃ©",cron:"PlanifiÃ© (Cron)"};function d(){let e=(0,a.useParams)();(0,a.useRouter)();let[d,o]=(0,t.useState)(null),[m,u]=(0,t.useState)(!0),p=e.id;(0,t.useEffect)(()=>{!async function(){u(!0),o(await (0,s.getRuleById)(p)),u(!1)}()},[p]);let f=async()=>{d&&o(await (0,s.toggleRuleStatus)(d.id))};return m?(0,i.jsx)("div",{className:"p-6",children:(0,i.jsx)("div",{className:"text-secondary",children:"Chargement..."})}):d?(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"flex items-center gap-3 mb-2",children:(0,i.jsx)(n.default,{href:"/automatic-rules",className:"text-secondary hover:text-primary",children:"â† Retour"})}),(0,i.jsx)("h1",{className:"text-2xl font-bold",children:d.name}),(0,i.jsxs)("p",{className:"text-secondary",children:["CrÃ©Ã©e le ",new Date(d.createdAt).toLocaleDateString("fr-FR")]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("button",{onClick:f,className:"btn btn-secondary",children:d.isActive?"â¸ï¸ DÃ©sactiver":"â–¶ï¸ Activer"}),(0,i.jsx)(n.default,{href:`/automatic-rules/${d.id}/edit`,className:"btn btn-primary",children:"âœï¸ Modifier"})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{className:"card p-4",children:[(0,i.jsx)("h3",{className:"font-semibold text-secondary mb-3",children:"Statut"}),(0,i.jsx)(l.RuleStatusBadge,{isActive:d.isActive})]}),(0,i.jsxs)("div",{className:"card p-4",children:[(0,i.jsx)("h3",{className:"font-semibold text-secondary mb-3",children:"Planification"}),(0,i.jsx)("div",{className:"font-medium",children:c[d.schedule.type]}),d.schedule.expression&&(0,i.jsx)("div",{className:"text-sm text-secondary font-mono mt-1",children:d.schedule.expression})]})]}),(0,i.jsxs)("div",{className:"card p-4 mt-6",children:[(0,i.jsx)("h3",{className:"font-semibold text-secondary mb-3",children:"ðŸŽ¯ DÃ©clencheur"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm text-secondary",children:"Table"}),(0,i.jsx)("div",{className:"font-medium",children:d.trigger.table})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm text-secondary",children:"Ã‰vÃ©nement"}),(0,i.jsx)("div",{className:"font-medium",children:"create"===d.trigger.event?"CrÃ©ation":"Modification"})]}),d.trigger.field&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm text-secondary",children:"Champ surveillÃ©"}),(0,i.jsx)("div",{className:"font-medium",children:d.trigger.field})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-sm text-secondary",children:"Transition"}),(0,i.jsxs)("div",{className:"font-medium",children:[d.trigger.fromValue||"*"," â†’ ",d.trigger.toValue||"*"]})]})]})]})]}),(0,i.jsxs)("div",{className:"card p-4 mt-6",children:[(0,i.jsx)("h3",{className:"font-semibold text-secondary mb-3",children:"ðŸ“¨ Communication LiÃ©e"}),(0,i.jsx)("div",{className:"font-medium text-lg mb-2",children:d.linkedCommunication.name}),(0,i.jsx)("div",{className:"flex gap-2",children:d.linkedCommunication.channels.map(e=>(0,i.jsx)("span",{className:"px-3 py-1 bg-muted rounded-full text-sm",children:r[e]||e},e))})]})]}):(0,i.jsx)("div",{className:"p-6",children:(0,i.jsxs)("div",{className:"card p-8 text-center",children:[(0,i.jsx)("div",{className:"text-4xl mb-4",children:"âŒ"}),(0,i.jsx)("h2",{className:"text-xl font-bold mb-2",children:"RÃ¨gle non trouvÃ©e"}),(0,i.jsx)(n.default,{href:"/automatic-rules",className:"btn btn-primary mt-4",children:"Retour Ã  la liste"})]})})}e.s(["RuleDetailClient",()=>d])}]);