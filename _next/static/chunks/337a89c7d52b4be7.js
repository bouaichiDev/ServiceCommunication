(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,34537,e=>{"use strict";var s=e.i(43476),a=e.i(18566),l=e.i(71645);let t=["target","channels","filters","schedule","templates","summary"],n={target:"SÃ©lectionner la Cible",channels:"Choisir les Canaux",filters:"Appliquer les Filtres",schedule:"Planification",templates:"ModÃ¨les",summary:"RÃ©vision & Envoi"};function i(){return{name:"",description:"",target:{scope:"client",tenantIds:[],clientIds:[],finalClientIds:[],staffIds:[],roleIds:[]},channels:[],filters:{plannedOnly:!1,dateFrom:null,dateTo:null,attributes:{}},schedule:{type:"immediate",scheduledAt:null,cronExpression:null,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},templates:[]}}let r=[{value:"t1",label:"SociÃ©tÃ© Acme"},{value:"t2",label:"Industries Globales"},{value:"t3",label:"Solutions Tech SARL"}],c=[{value:"c1",label:"Client Alpha"},{value:"c2",label:"Client BÃªta"},{value:"c3",label:"Client Gamma"},{value:"c4",label:"Client Delta"}],d=[{value:"r1",label:"Administrateur"},{value:"r2",label:"Gestionnaire"},{value:"r3",label:"Membre du Personnel"},{value:"r4",label:"Lecteur"}],o=[{id:"tpl1",name:"Email de Bienvenue",channel:"email",subject:"Bienvenue !",body:"Bonjour {{name}}..."},{id:"tpl2",name:"Email de Rappel",channel:"email",subject:"Rappel",body:"Ceci est un rappel..."},{id:"tpl3",name:"Alerte SMS",channel:"sms",body:"Alerte : {{message}}"},{id:"tpl4",name:"Bienvenue WhatsApp",channel:"whatsapp",body:"Bienvenue dans notre service !"},{id:"tpl5",name:"Notification Push",channel:"notification",body:"Vous avez un nouveau message"}],m=[{id:"rec1",name:"John Doe",email:"john@example.com",phone:"+1234567890",type:"client"},{id:"rec2",name:"Jane Smith",email:"jane@example.com",phone:"+1234567891",type:"client"},{id:"rec3",name:"Bob Wilson",email:"bob@example.com",phone:"+1234567892",type:"staff"},{id:"rec4",name:"Alice Brown",email:"alice@example.com",phone:"+1234567893",type:"final_client"},{id:"rec5",name:"Charlie Davis",email:"charlie@example.com",type:"tenant"}];async function u(){return await new Promise(e=>setTimeout(e,300)),r}async function h(e){return await new Promise(e=>setTimeout(e,300)),console.log("Fetching clients for tenant:",e),c}async function p(){return await new Promise(e=>setTimeout(e,200)),d}async function x(e){return(await new Promise(e=>setTimeout(e,300)),e)?o.filter(s=>s.channel===e):o}async function b(e){return await new Promise(e=>setTimeout(e,500)),console.log("Preview recipients for draft:",e),m.filter(s=>e.target.scope===s.type||"tenant"===e.target.scope)}async function v(e){return await new Promise(e=>setTimeout(e,800)),console.log("Creating campaign with payload:",JSON.stringify(e,null,2)),{id:Date.now().toString()}}async function j(e){let s=[];return e.name.trim()||s.push("Le nom de la campagne est requis"),0===e.channels.length&&s.push("SÃ©lectionnez au moins un canal"),0===e.templates.length&&s.push("Configurez au moins un modÃ¨le"),s}function f({currentStep:e,onStepClick:a}){let l=t.indexOf(e);return(0,s.jsx)("div",{className:"flex items-center justify-between mb-8",children:t.map((i,r)=>{let c=i===e,d=r<l,o=r<=l;return(0,s.jsxs)("div",{className:"flex items-center flex-1",children:[(0,s.jsxs)("button",{onClick:()=>o&&a(i),disabled:!o,className:`flex items-center gap-2 ${o?"cursor-pointer":"cursor-not-allowed"}`,children:[(0,s.jsx)("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-colors ${c?"bg-primary text-white":d?"bg-green-500 text-white":"bg-muted text-secondary"}`,children:d?"âœ“":r+1}),(0,s.jsx)("span",{className:`hidden md:block text-sm ${c?"font-semibold text-foreground":"text-secondary"}`,children:n[i]})]}),r<t.length-1&&(0,s.jsx)("div",{className:`flex-1 h-0.5 mx-2 ${r<l?"bg-green-500":"bg-border"}`})]},i)})})}let g=[{value:"tenant",label:"Locataire",description:"Tous les utilisateurs des locataires sÃ©lectionnÃ©s"},{value:"client",label:"Client",description:"Organisations clientes spÃ©cifiques"},{value:"final_client",label:"Client Final",description:"Utilisateurs finaux / clients"},{value:"staff",label:"Personnel",description:"Membres du personnel interne"},{value:"role",label:"RÃ´le",description:"Utilisateurs avec des rÃ´les spÃ©cifiques"}];function N({target:e,tenants:a,clients:t,roles:n,isLoading:i,onTargetChange:r,onLoadTenants:c,onLoadClients:d,onLoadRoles:o}){(0,l.useEffect)(()=>{c(),d(),o()},[c,d,o]);let m=()=>{switch(e.scope){case"tenant":return e.tenantIds;case"client":return e.clientIds;case"final_client":return e.finalClientIds;case"staff":return e.staffIds;case"role":return e.roleIds;default:return[]}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"SÃ©lectionner la PortÃ©e Cible"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:g.map(a=>(0,s.jsxs)("button",{onClick:()=>{var s;return s=a.value,void r({...e,scope:s})},className:`p-4 rounded-lg border text-left transition-colors ${e.scope===a.value?"border-primary bg-blue-50":"border-border hover:border-primary/50"}`,children:[(0,s.jsx)("div",{className:"font-medium",children:a.label}),(0,s.jsx)("div",{className:"text-sm text-secondary",children:a.description})]},a.value))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"SÃ©lectionner les Destinataires"}),i?(0,s.jsx)("div",{className:"text-secondary",children:"Chargement des options..."}):(0,s.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto border border-border rounded-lg p-3",children:(()=>{switch(e.scope){case"tenant":return a;case"client":case"final_client":case"staff":return t;case"role":return n;default:return[]}})().map(a=>(0,s.jsxs)("label",{className:"flex items-center gap-3 p-2 hover:bg-muted rounded",children:[(0,s.jsx)("input",{type:"checkbox",checked:m().includes(a.value),onChange:s=>{let l=m();var t=s.target.checked?[...l,a.value]:l.filter(e=>e!==a.value);let n={...e};switch(e.scope){case"tenant":n.tenantIds=t;break;case"client":n.clientIds=t;break;case"final_client":n.finalClientIds=t;break;case"staff":n.staffIds=t;break;case"role":n.roleIds=t}r(n)},className:"w-4 h-4"}),(0,s.jsx)("span",{children:a.label})]},a.value))})]})]})}let y=[{value:"email",label:"Email",icon:"âœ‰ï¸",description:"Envoyez des emails HTML riches avec piÃ¨ces jointes"},{value:"sms",label:"SMS",icon:"ðŸ’¬",description:"Messages texte courts (160 caractÃ¨res)"},{value:"whatsapp",label:"WhatsApp",icon:"ðŸ“±",description:"Messagerie riche avec support mÃ©dia"},{value:"notification",label:"Notification Push",icon:"ðŸ””",description:"Notifications push in-app et mobile"}];function C({selectedChannels:e,onChannelsChange:a}){return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"SÃ©lectionner les Canaux de Communication"}),(0,s.jsx)("p",{className:"text-secondary mb-4",children:"Choisissez un ou plusieurs canaux pour atteindre votre audience. Chaque canal nÃ©cessitera son propre modÃ¨le."})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:y.map(l=>{let t=e.includes(l.value);return(0,s.jsx)("button",{onClick:()=>{var s;return s=l.value,void(e.includes(s)?a(e.filter(e=>e!==s)):a([...e,s]))},className:`p-6 rounded-xl border-2 text-left transition-all ${t?"border-primary bg-blue-50 shadow-md":"border-border hover:border-primary/50 hover:shadow-sm"}`,children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("span",{className:"text-3xl",children:l.icon}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"font-semibold text-lg",children:l.label}),(0,s.jsx)("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${t?"border-primary bg-primary":"border-border"}`,children:t&&(0,s.jsx)("span",{className:"text-white text-xs",children:"âœ“"})})]}),(0,s.jsx)("p",{className:"text-sm text-secondary mt-1",children:l.description})]})]})},l.value)})}),e.length>0&&(0,s.jsxs)("div",{className:"bg-muted rounded-lg p-4",children:[(0,s.jsx)("div",{className:"text-sm font-medium mb-2",children:"Canaux SÃ©lectionnÃ©s :"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:e.map(e=>{let a=y.find(s=>s.value===e);return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-primary/10 text-primary rounded-full text-sm",children:[a?.icon," ",a?.label]},e)})})]})]})}function w({filters:e,onFiltersChange:a}){let l=(s,l)=>{let t={...e.attributes};l?t[s]=l:delete t[s],a({...e,attributes:t})};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Filtrer les Destinataires"}),(0,s.jsx)("p",{className:"text-secondary mb-4",children:"Affinez votre audience avec des filtres supplÃ©mentaires. Tous les filtres sont optionnels."})]}),(0,s.jsx)("div",{className:"card p-4",children:(0,s.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:e.plannedOnly,onChange:s=>{var l;return l=s.target.checked,void a({...e,plannedOnly:l})},className:"w-5 h-5 rounded"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:"Destinataires PlanifiÃ©s Uniquement"}),(0,s.jsx)("div",{className:"text-sm text-secondary",children:"Inclure uniquement les destinataires avec des rendez-vous ou activitÃ©s planifiÃ©s"})]})]})}),(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("h4",{className:"font-medium mb-4",children:"Filtre par Plage de Dates"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Date de DÃ©but"}),(0,s.jsx)("input",{type:"date",value:e.dateFrom||"",onChange:s=>{var l;return l=s.target.value,void a({...e,dateFrom:l||null})},className:"input"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Date de Fin"}),(0,s.jsx)("input",{type:"date",value:e.dateTo||"",onChange:s=>{var l;return l=s.target.value,void a({...e,dateTo:l||null})},className:"input"})]})]})]}),(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("h4",{className:"font-medium mb-4",children:"Attributs PersonnalisÃ©s"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"RÃ©gion"}),(0,s.jsxs)("select",{value:e.attributes.region||"",onChange:e=>l("region",e.target.value),className:"input",children:[(0,s.jsx)("option",{value:"",children:"Toutes les RÃ©gions"}),(0,s.jsx)("option",{value:"north",children:"Nord"}),(0,s.jsx)("option",{value:"south",children:"Sud"}),(0,s.jsx)("option",{value:"east",children:"Est"}),(0,s.jsx)("option",{value:"west",children:"Ouest"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Statut"}),(0,s.jsxs)("select",{value:e.attributes.status||"",onChange:e=>l("status",e.target.value),className:"input",children:[(0,s.jsx)("option",{value:"",children:"Tous les Statuts"}),(0,s.jsx)("option",{value:"active",children:"Actif"}),(0,s.jsx)("option",{value:"inactive",children:"Inactif"}),(0,s.jsx)("option",{value:"pending",children:"En attente"})]})]})]})]}),(0,s.jsx)("div",{className:"bg-muted rounded-lg p-4",children:(0,s.jsxs)("div",{className:"text-sm text-secondary",children:[(0,s.jsx)("strong",{children:"Filtres Actifs :"})," ",e.plannedOnly&&(0,s.jsx)("span",{className:"mr-2",children:"PlanifiÃ©s Uniquement"}),e.dateFrom&&(0,s.jsxs)("span",{className:"mr-2",children:["De : ",e.dateFrom]}),e.dateTo&&(0,s.jsxs)("span",{className:"mr-2",children:["Ã€ : ",e.dateTo]}),Object.entries(e.attributes).map(([e,a])=>(0,s.jsxs)("span",{className:"mr-2",children:[e,": ",a]},e)),!e.plannedOnly&&!e.dateFrom&&!e.dateTo&&0===Object.keys(e.attributes).length&&"Aucun"]})})]})}let S=[{value:"immediate",label:"Envoyer ImmÃ©diatement",description:"La campagne sera envoyÃ©e dÃ¨s que vous confirmez"},{value:"scheduled",label:"Planifier pour Plus Tard",description:"Choisissez une date et heure spÃ©cifiques pour l'envoi"},{value:"cron",label:"Planification RÃ©currente",description:"Configurez une campagne rÃ©currente avec une expression cron"}],k=[{label:"Quotidien Ã  9h",value:"0 9 * * *"},{label:"Hebdomadaire le Lundi",value:"0 9 * * 1"},{label:"Mensuel le 1er",value:"0 9 1 * *"},{label:"Toutes les Heures",value:"0 * * * *"}];function T({schedule:e,onScheduleChange:a}){let l=s=>{a({...e,cronExpression:s||null})};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Planifier Votre Campagne"}),(0,s.jsx)("p",{className:"text-secondary mb-4",children:"Choisissez quand envoyer votre communication aux destinataires."})]}),(0,s.jsx)("div",{className:"space-y-3",children:S.map(l=>(0,s.jsx)("button",{onClick:()=>{var s;return s=l.value,void a({...e,type:s,scheduledAt:"scheduled"===s?e.scheduledAt:null,cronExpression:"cron"===s?e.cronExpression:null})},className:`w-full p-4 rounded-lg border-2 text-left transition-all ${e.type===l.value?"border-primary bg-blue-50":"border-border hover:border-primary/50"}`,children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${e.type===l.value?"border-primary bg-primary":"border-border"}`,children:e.type===l.value&&(0,s.jsx)("span",{className:"text-white text-xs",children:"âœ“"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:l.label}),(0,s.jsx)("div",{className:"text-sm text-secondary",children:l.description})]})]})},l.value))}),"scheduled"===e.type&&(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("label",{className:"label",children:"SÃ©lectionner Date & Heure"}),(0,s.jsx)("input",{type:"datetime-local",value:e.scheduledAt||"",onChange:s=>{var l;return l=s.target.value,void a({...e,scheduledAt:l||null})},min:new Date().toISOString().slice(0,16),className:"input"})]}),"cron"===e.type&&(0,s.jsxs)("div",{className:"card p-4 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Expression Cron"}),(0,s.jsx)("input",{type:"text",value:e.cronExpression||"",onChange:e=>l(e.target.value),placeholder:"0 9 * * *",className:"input font-mono"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm text-secondary mb-2",children:"PrÃ©rÃ©glages Rapides :"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:k.map(e=>(0,s.jsx)("button",{onClick:()=>l(e.value),className:"btn btn-outline text-sm py-1",children:e.label},e.value))})]})]}),(0,s.jsxs)("div",{className:"text-sm text-secondary",children:["Fuseau Horaire : ",(0,s.jsx)("strong",{children:e.timezone})]})]})}let P={email:"Email",sms:"SMS",whatsapp:"WhatsApp",notification:"Notification Push"};function A({selectedChannels:e,templates:a,availableTemplates:t,isLoading:n,onTemplatesChange:i,onLoadTemplates:r}){return((0,l.useEffect)(()=>{r()},[r]),0===e.length)?(0,s.jsx)("div",{className:"text-center py-12 text-secondary",children:"Veuillez sÃ©lectionner au moins un canal Ã  l'Ã©tape prÃ©cÃ©dente."}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Configurer les ModÃ¨les"}),(0,s.jsx)("p",{className:"text-secondary mb-4",children:"Configurez les modÃ¨les de message pour chaque canal sÃ©lectionnÃ©."})]}),n?(0,s.jsx)("div",{className:"text-secondary",children:"Chargement des modÃ¨les..."}):(0,s.jsx)("div",{className:"space-y-6",children:e.map(e=>{let l=t.filter(s=>s.channel===e),n=a.find(s=>s.channel===e);return(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsxs)("h4",{className:"font-semibold mb-4",children:["ModÃ¨le ",P[e]]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"SÃ©lectionner un ModÃ¨le"}),(0,s.jsxs)("select",{value:n?.templateId||"",onChange:s=>{var l;let n;return l=s.target.value,void(!(n=t.find(e=>e.id===l))||i([...a.filter(s=>s.channel!==e),{channel:e,templateId:n.id,subject:n.subject,body:n.body}]))},className:"input",children:[(0,s.jsx)("option",{value:"",children:"Choisir un modÃ¨le..."}),l.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),n&&"email"===e&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Sujet"}),(0,s.jsx)("input",{type:"text",value:n.subject||"",onChange:s=>{var l;return l=s.target.value,void i(a.map(s=>s.channel===e?{...s,subject:l}:s))},className:"input",placeholder:"Sujet de l'email..."})]}),n&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Corps du Message"}),(0,s.jsx)("textarea",{value:n.body,onChange:s=>{var l;return l=s.target.value,void i(a.map(s=>s.channel===e?{...s,body:l}:s))},className:"input min-h-[120px]",placeholder:"Entrez votre message..."}),(0,s.jsxs)("div",{className:"text-xs text-secondary mt-1",children:["Utilisez ","{{name}}",", ","{{email}}"," pour la personnalisation"]})]})]})]},e)})})]})}let E={email:"Email",sms:"SMS",whatsapp:"WhatsApp",notification:"Notification Push"};function I({draft:e,recipients:a,isLoading:t,onLoadPreview:n}){return(0,l.useEffect)(()=>{n()},[n]),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"RÃ©visez Votre Campagne"}),(0,s.jsx)("p",{className:"text-secondary mb-4",children:"Veuillez vÃ©rifier tous les dÃ©tails avant d'envoyer votre campagne."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("h4",{className:"font-medium text-secondary mb-2",children:"Nom de la Campagne"}),(0,s.jsx)("p",{className:"font-semibold",children:e.name||"Campagne Sans Titre"}),e.description&&(0,s.jsx)("p",{className:"text-sm text-secondary mt-1",children:e.description})]}),(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("h4",{className:"font-medium text-secondary mb-2",children:"PortÃ©e Cible"}),(0,s.jsx)("p",{className:"font-semibold capitalize",children:e.target.scope.replace("_"," ")})]}),(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("h4",{className:"font-medium text-secondary mb-2",children:"Canaux"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:e.channels.map(e=>(0,s.jsx)("span",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm",children:E[e]},e))})]}),(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("h4",{className:"font-medium text-secondary mb-2",children:"Planification"}),(0,s.jsx)("p",{className:"font-semibold capitalize",children:e.schedule.type}),e.schedule.scheduledAt&&(0,s.jsx)("p",{className:"text-sm text-secondary",children:new Date(e.schedule.scheduledAt).toLocaleString()}),e.schedule.cronExpression&&(0,s.jsx)("p",{className:"text-sm font-mono text-secondary",children:e.schedule.cronExpression})]})]}),(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("h4",{className:"font-medium text-secondary mb-3",children:"ModÃ¨les ConfigurÃ©s"}),(0,s.jsxs)("div",{className:"space-y-3",children:[e.templates.map(e=>(0,s.jsxs)("div",{className:"p-3 bg-muted rounded-lg",children:[(0,s.jsx)("div",{className:"font-medium",children:E[e.channel]}),e.subject&&(0,s.jsxs)("div",{className:"text-sm",children:["Sujet : ",e.subject]}),(0,s.jsx)("div",{className:"text-sm text-secondary truncate",children:e.body})]},e.channel)),0===e.templates.length&&(0,s.jsx)("p",{className:"text-secondary",children:"Aucun modÃ¨le configurÃ©"})]})]}),(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsxs)("h4",{className:"font-medium text-secondary mb-3",children:["AperÃ§u des Destinataires (",t?"...":a.length,")"]}),t?(0,s.jsx)("div",{className:"text-secondary",children:"Chargement des destinataires..."}):(0,s.jsxs)("div",{className:"max-h-48 overflow-y-auto",children:[(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-border",children:[(0,s.jsx)("th",{className:"text-left py-2",children:"Nom"}),(0,s.jsx)("th",{className:"text-left py-2",children:"Email"}),(0,s.jsx)("th",{className:"text-left py-2",children:"TÃ©lÃ©phone"})]})}),(0,s.jsx)("tbody",{children:a.slice(0,10).map(e=>(0,s.jsxs)("tr",{className:"border-b border-border",children:[(0,s.jsx)("td",{className:"py-2",children:e.name}),(0,s.jsx)("td",{className:"py-2",children:e.email||"-"}),(0,s.jsx)("td",{className:"py-2",children:e.phone||"-"})]},e.id))})]}),a.length>10&&(0,s.jsxs)("p",{className:"text-sm text-secondary mt-2",children:["Et ",a.length-10," autres destinataires..."]})]})]})]})}function z({onComplete:e,onCancel:a}){let n=function(){let[e,s]=(0,l.useState)(i),[a,n]=(0,l.useState)("target"),r=t.indexOf(a),c=0===r,d=r===t.length-1,o=(0,l.useCallback)(e=>{s(s=>({...s,name:e}))},[]),m=(0,l.useCallback)(e=>{s(s=>({...s,description:e}))},[]),u=(0,l.useCallback)(e=>{s(s=>({...s,target:e}))},[]),h=(0,l.useCallback)(e=>{s(s=>({...s,channels:e}))},[]),p=(0,l.useCallback)(e=>{s(s=>({...s,filters:e}))},[]),x=(0,l.useCallback)(e=>{s(s=>({...s,schedule:e}))},[]),b=(0,l.useCallback)(e=>{s(s=>({...s,templates:e}))},[]),v=(0,l.useCallback)(e=>{n(e)},[]),j=(0,l.useCallback)(()=>{d||n(t[r+1])},[r,d]),f=(0,l.useCallback)(()=>{c||n(t[r-1])},[r,c]);return{draft:e,currentStep:a,stepIndex:r,isFirstStep:c,isLastStep:d,setName:o,setDescription:m,setTarget:u,setChannels:h,setFilters:p,setSchedule:x,setTemplates:b,goToStep:v,nextStep:j,prevStep:f,resetDraft:(0,l.useCallback)(()=>{s(i()),n("target")},[])}}(),r=function(){let[e,s]=(0,l.useState)([]),[a,t]=(0,l.useState)([]),[n,i]=(0,l.useState)([]),[r,c]=(0,l.useState)([]),[d,o]=(0,l.useState)([]),[m,f]=(0,l.useState)(!1),[g,N]=(0,l.useState)(!1),[y,C]=(0,l.useState)([]),w=(0,l.useCallback)(async()=>{f(!0);try{let e=await u();s(e)}finally{f(!1)}},[]),S=(0,l.useCallback)(async e=>{f(!0);try{let s=await h(e);t(s)}finally{f(!1)}},[]),k=(0,l.useCallback)(async()=>{f(!0);try{let e=await p();i(e)}finally{f(!1)}},[]),T=(0,l.useCallback)(async e=>{f(!0);try{let s=await x(e);c(s)}finally{f(!1)}},[]),P=(0,l.useCallback)(async e=>{f(!0);try{let s=await b(e);o(s)}finally{f(!1)}},[]),A=(0,l.useCallback)(async e=>{let s=await j(e);return C(s),0===s.length},[]);return{tenants:e,clients:a,roles:n,templates:r,recipients:d,isLoading:m,isSending:g,errors:y,loadTenants:w,loadClients:S,loadRoles:k,loadTemplates:T,loadRecipientPreview:P,submitCampaign:(0,l.useCallback)(async e=>{if(!await A(e))return null;N(!0);try{let s={name:e.name,description:e.description,target:{scope:e.target.scope,ids:function(e){switch(e.target.scope){case"tenant":return e.target.tenantIds;case"client":return e.target.clientIds;case"final_client":return e.target.finalClientIds;case"staff":return e.target.staffIds;case"role":return e.target.roleIds;default:return[]}}(e)},channels:e.channels,filters:{planned_only:e.filters.plannedOnly,date_range:{from:e.filters.dateFrom,to:e.filters.dateTo},attributes:e.filters.attributes},schedule:{type:e.schedule.type,scheduled_at:e.schedule.scheduledAt,cron_expression:e.schedule.cronExpression,timezone:e.schedule.timezone},templates:e.templates.map(e=>({channel:e.channel,template_id:e.templateId,subject:e.subject,body:e.body}))};return console.log("Submitting campaign payload:",s),(await v(e)).id}catch(e){return C([e instanceof Error?e.message:"Failed to create campaign"]),null}finally{N(!1)}},[A]),validate:A,clearErrors:(0,l.useCallback)(()=>{C([])},[])}}(),c=async()=>{let s=await r.submitCampaign(n.draft);s&&e(s)};return(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsx)(f,{currentStep:n.currentStep,onStepClick:n.goToStep}),"target"===n.currentStep&&(0,s.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Nom de la Campagne *"}),(0,s.jsx)("input",{type:"text",value:n.draft.name,onChange:e=>n.setName(e.target.value),className:"input",placeholder:"Entrez le nom de la campagne..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Description"}),(0,s.jsx)("textarea",{value:n.draft.description,onChange:e=>n.setDescription(e.target.value),className:"input min-h-[80px]",placeholder:"Description optionnelle..."})]})]}),r.errors.length>0&&(0,s.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,s.jsx)("ul",{className:"list-disc list-inside text-error text-sm",children:r.errors.map((e,a)=>(0,s.jsx)("li",{children:e},a))})}),(0,s.jsx)("div",{className:"card p-6 mb-6",children:(()=>{switch(n.currentStep){case"target":return(0,s.jsx)(N,{target:n.draft.target,tenants:r.tenants,clients:r.clients,roles:r.roles,isLoading:r.isLoading,onTargetChange:n.setTarget,onLoadTenants:r.loadTenants,onLoadClients:r.loadClients,onLoadRoles:r.loadRoles});case"channels":return(0,s.jsx)(C,{selectedChannels:n.draft.channels,onChannelsChange:n.setChannels});case"filters":return(0,s.jsx)(w,{filters:n.draft.filters,onFiltersChange:n.setFilters});case"schedule":return(0,s.jsx)(T,{schedule:n.draft.schedule,onScheduleChange:n.setSchedule});case"templates":return(0,s.jsx)(A,{selectedChannels:n.draft.channels,templates:n.draft.templates,availableTemplates:r.templates,isLoading:r.isLoading,onTemplatesChange:n.setTemplates,onLoadTemplates:r.loadTemplates});case"summary":return(0,s.jsx)(I,{draft:n.draft,recipients:r.recipients,isLoading:r.isLoading,onLoadPreview:()=>r.loadRecipientPreview(n.draft)});default:return null}})()}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("div",{children:n.isFirstStep?(0,s.jsx)("button",{onClick:a,className:"btn btn-secondary",children:"Annuler"}):(0,s.jsx)("button",{onClick:n.prevStep,className:"btn btn-secondary",children:"PrÃ©cÃ©dent"})}),(0,s.jsx)("div",{children:n.isLastStep?(0,s.jsx)("button",{onClick:c,disabled:r.isSending,className:"btn btn-primary",children:r.isSending?"Envoi en cours...":"Envoyer la Campagne"}):(0,s.jsx)("button",{onClick:n.nextStep,className:"btn btn-primary",children:"Suivant"})})]})]})}function D(){let e=(0,a.useRouter)();return(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"CrÃ©er une Campagne"}),(0,s.jsx)("p",{className:"text-secondary",children:"CrÃ©ez et envoyez des communications Ã  votre audience"})]}),(0,s.jsx)(z,{onComplete:s=>{e.push(`/campaign-details/${s}`)},onCancel:()=>{e.push("/communications")}})]})}e.s(["default",()=>D],34537)}]);