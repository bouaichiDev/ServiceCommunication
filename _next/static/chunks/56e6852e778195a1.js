(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3285,e=>{"use strict";let a=[{name:"OT",label:"Ordre de Travail",description:"Table principale des ordres de travail"},{name:"OTDetail",label:"DÃ©tail OT",description:"Lignes de dÃ©tail des ordres de travail"},{name:"OT_Packages",label:"Colis OT",description:"Colis associÃ©s aux ordres de travail"},{name:"PLANS",label:"Plans",description:"Planification des livraisons"},{name:"CLIENTS",label:"Clients",description:"Table des clients"},{name:"STAFF",label:"Personnel",description:"Table du personnel"}],s={OT:[{name:"status",label:"Statut",type:"string",possibleValues:["DRAFT","PLANNED","IN_PROGRESS","DELIVERED","CANCELLED"]},{name:"delivery_date",label:"Date de livraison",type:"date"},{name:"client_id",label:"ID Client",type:"string"},{name:"priority",label:"PrioritÃ©",type:"number"},{name:"is_urgent",label:"Urgent",type:"boolean"}],OTDetail:[{name:"quantity",label:"QuantitÃ©",type:"number"},{name:"product_code",label:"Code Produit",type:"string"},{name:"status",label:"Statut",type:"string",possibleValues:["PENDING","PICKED","PACKED"]}],OT_Packages:[{name:"package_status",label:"Statut Colis",type:"string",possibleValues:["CREATED","SHIPPED","DELIVERED"]},{name:"weight",label:"Poids",type:"number"},{name:"tracking_number",label:"NumÃ©ro de suivi",type:"string"}],PLANS:[{name:"plan_date",label:"Date du plan",type:"date"},{name:"driver_id",label:"ID Chauffeur",type:"string"},{name:"status",label:"Statut",type:"string",possibleValues:["DRAFT","CONFIRMED","COMPLETED"]}],CLIENTS:[{name:"name",label:"Nom",type:"string"},{name:"email",label:"Email",type:"string"},{name:"is_active",label:"Actif",type:"boolean"}],STAFF:[{name:"name",label:"Nom",type:"string"},{name:"role",label:"RÃ´le",type:"string"},{name:"email",label:"Email",type:"string"}]},l=[{id:"comm1",name:"Notification Livraison PlanifiÃ©e",description:"Informe le client que sa livraison est planifiÃ©e",channels:["email","sms"],recipientType:"final_client",recipientDetails:"Client final liÃ© Ã  l'OT",frequency:"once",subject:"Votre livraison est planifiÃ©e",bodyPreview:"Bonjour {{client_name}}, votre commande sera livrÃ©e le {{delivery_date}}...",attachments:["Bon de livraison"],createdAt:"2024-01-10T09:00:00Z",createdBy:"Jean Directeur"},{id:"comm2",name:"Confirmation de Livraison",description:"Confirme que la livraison a Ã©tÃ© effectuÃ©e",channels:["email"],recipientType:"final_client",recipientDetails:"Client final liÃ© Ã  l'OT",frequency:"once",subject:"Livraison effectuÃ©e",bodyPreview:"Bonjour {{client_name}}, votre commande a Ã©tÃ© livrÃ©e avec succÃ¨s...",attachments:["Preuve de livraison","Facture"],createdAt:"2024-01-12T14:00:00Z",createdBy:"Marie Admin"},{id:"comm3",name:"Alerte Retard Livraison",description:"Alerte le gestionnaire en cas de retard",channels:["email","whatsapp"],recipientType:"role",recipientDetails:"Gestionnaires",frequency:"once",subject:"Alerte: Retard de livraison",bodyPreview:"Attention, l'OT {{ot_id}} est en retard de livraison...",attachments:[],createdAt:"2024-01-15T10:00:00Z",createdBy:"Admin SystÃ¨me"},{id:"comm4",name:"Rapport Quotidien",description:"Rapport quotidien des opÃ©rations",channels:["email"],recipientType:"staff",recipientDetails:"Tout le personnel",frequency:"daily",subject:"Rapport du {{date}}",bodyPreview:"Voici le rÃ©sumÃ© des opÃ©rations du jour...",attachments:["Rapport PDF"],createdAt:"2024-01-08T08:00:00Z",createdBy:"Jean Directeur"}];async function i(){return await new Promise(e=>setTimeout(e,300)),a}async function n(e){return await new Promise(e=>setTimeout(e,300)),s[e]||[]}async function t(){return await new Promise(e=>setTimeout(e,400)),l}async function r(e){return await new Promise(e=>setTimeout(e,800)),console.log("Creating automatic rule:",JSON.stringify(e,null,2)),{id:Date.now().toString()}}async function c(e){let a=[];return e.name.trim()||a.push("Le nom de la rÃ¨gle est requis"),e.trigger.tableName||a.push("SÃ©lectionnez une table source"),e.trigger.event||a.push("SÃ©lectionnez un type d'Ã©vÃ©nement"),e.communicationId||a.push("SÃ©lectionnez une communication"),a}let d=[{id:"rule1",name:"Notification OT PlanifiÃ©",isActive:!0,trigger:{table:"OT",event:"update",field:"status",fromValue:"DRAFT",toValue:"PLANNED"},linkedCommunication:{id:"comm1",name:"Notification Livraison PlanifiÃ©e",channels:["email","sms"]},schedule:{type:"immediate"},createdAt:"2024-01-15T10:00:00Z"},{id:"rule2",name:"Confirmation Livraison EffectuÃ©e",isActive:!0,trigger:{table:"OT",event:"update",field:"status",toValue:"DELIVERED"},linkedCommunication:{id:"comm2",name:"Confirmation de Livraison",channels:["email"]},schedule:{type:"delayed",expression:"15 min"},createdAt:"2024-01-16T14:00:00Z"},{id:"rule3",name:"Alerte Colis ExpÃ©diÃ©",isActive:!1,trigger:{table:"OT_Packages",event:"update",field:"package_status",toValue:"SHIPPED"},linkedCommunication:{id:"comm1",name:"Notification Livraison PlanifiÃ©e",channels:["email","sms"]},schedule:{type:"immediate"},createdAt:"2024-01-17T09:00:00Z"},{id:"rule4",name:"Rapport Quotidien Automatique",isActive:!0,trigger:{table:"PLANS",event:"create"},linkedCommunication:{id:"comm4",name:"Rapport Quotidien",channels:["email"]},schedule:{type:"cron",expression:"0 18 * * *"},createdAt:"2024-01-10T08:00:00Z"},{id:"rule5",name:"Alerte Retard Livraison",isActive:!0,trigger:{table:"OT",event:"update",field:"status",toValue:"CANCELLED"},linkedCommunication:{id:"comm3",name:"Alerte Retard Livraison",channels:["email","whatsapp"]},schedule:{type:"immediate"},createdAt:"2024-01-18T11:00:00Z"}];async function o(){return await new Promise(e=>setTimeout(e,400)),[...d]}async function u(e){await new Promise(e=>setTimeout(e,300));let a=d.find(a=>a.id===e);if(!a)throw Error("Rule not found");return a.isActive=!a.isActive,{...a}}async function m(e){await new Promise(e=>setTimeout(e,300));let a=d.findIndex(a=>a.id===e);-1!==a&&d.splice(a,1)}async function p(e){return await new Promise(e=>setTimeout(e,300)),d.find(a=>a.id===e)||null}e.s(["createRule",()=>r,"deleteRule",()=>m,"fetchAvailableTables",()=>i,"fetchCommunications",()=>t,"fetchTableFields",()=>n,"getRuleById",()=>p,"getRules",()=>o,"toggleRuleStatus",()=>u,"validateRule",()=>c])},40214,e=>{"use strict";var a=e.i(43476),s=e.i(71645);let l=["trigger","conditions","communication","schedule","summary"],i={trigger:"DÃ©clencheur",conditions:"Conditions",communication:"Communication",schedule:"Planification",summary:"RÃ©sumÃ©"};function n(){return{name:"",description:"",trigger:{tableName:"",event:"on_update",fieldName:void 0,fromValue:void 0,toValue:void 0},conditionGroup:{logic:"AND",conditions:[]},communicationId:"",schedule:{type:"immediate",timezone:"Europe/Paris"},isActive:!0}}var t=e.i(3285);function r({currentStep:e,onStepClick:s}){let n=l.indexOf(e);return(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:l.map((e,t)=>{let r=t<n,c=t===n;return(0,a.jsxs)("div",{className:"flex items-center flex-1",children:[(0,a.jsxs)("button",{onClick:()=>s(e),className:`flex flex-col items-center gap-2 ${r||c?"cursor-pointer":"cursor-default"}`,children:[(0,a.jsx)("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium transition-colors ${r?"bg-green-500 text-white":c?"bg-primary text-white":"bg-muted text-secondary"}`,children:r?"âœ“":t+1}),(0,a.jsx)("span",{className:`text-xs text-center max-w-[80px] ${c?"font-medium text-primary":"text-secondary"}`,children:i[e]})]}),t<l.length-1&&(0,a.jsx)("div",{className:`flex-1 h-1 mx-2 rounded ${t<n?"bg-green-500":"bg-muted"}`})]},e)})})})}let c=[{value:"on_create",label:"Ã€ la crÃ©ation",description:"DÃ©clenchÃ© quand un enregistrement est crÃ©Ã©"},{value:"on_update",label:"Ã€ la modification",description:"DÃ©clenchÃ© quand un enregistrement est modifiÃ©"}];function d({trigger:e,tables:l,fields:i,isLoading:n,onTriggerChange:t,onLoadTables:r,onLoadFields:d}){(0,s.useEffect)(()=>{r()},[r]),(0,s.useEffect)(()=>{e.tableName&&d(e.tableName)},[e.tableName,d]);let o=i.find(a=>a.name===e.fieldName);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Configurer le DÃ©clencheur"}),(0,a.jsx)("p",{className:"text-secondary mb-4",children:"DÃ©finissez sur quelle table et quel Ã©vÃ©nement la rÃ¨gle doit se dÃ©clencher."})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("label",{className:"label",children:"Table Source *"}),n&&0===l.length?(0,a.jsx)("div",{className:"text-secondary",children:"Chargement des tables..."}):(0,a.jsxs)("select",{value:e.tableName,onChange:a=>{var s;return s=a.target.value,void t({...e,tableName:s,fieldName:void 0,fromValue:void 0,toValue:void 0})},className:"input",children:[(0,a.jsx)("option",{value:"",children:"SÃ©lectionner une table..."}),l.map(e=>(0,a.jsxs)("option",{value:e.name,children:[e.label," (",e.name,")"]},e.name))]}),e.tableName&&(0,a.jsx)("p",{className:"text-xs text-secondary mt-1",children:l.find(a=>a.name===e.tableName)?.description})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("label",{className:"label",children:"Type d'Ã‰vÃ©nement *"}),(0,a.jsx)("div",{className:"space-y-2",children:c.map(s=>(0,a.jsxs)("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${e.event===s.value?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:[(0,a.jsx)("input",{type:"radio",name:"triggerEvent",value:s.value,checked:e.event===s.value,onChange:()=>{var a;return a=s.value,void t({...e,event:a})},className:"mt-1"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:s.label}),(0,a.jsx)("div",{className:"text-sm text-secondary",children:s.description})]})]},s.value))})]}),e.tableName&&"on_update"===e.event&&(0,a.jsxs)("div",{className:"card p-4 space-y-4",children:[(0,a.jsx)("label",{className:"label",children:"Champ Ã  Surveiller (optionnel)"}),(0,a.jsxs)("select",{value:e.fieldName||"",onChange:a=>t({...e,fieldName:a.target.value||void 0}),className:"input",children:[(0,a.jsx)("option",{value:"",children:"Tous les champs"}),i.map(e=>(0,a.jsxs)("option",{value:e.name,children:[e.label," (",e.name,")"]},e.name))]}),e.fieldName&&o&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Valeur Initiale (De)"}),o.possibleValues?(0,a.jsxs)("select",{value:e.fromValue||"",onChange:a=>t({...e,fromValue:a.target.value||void 0}),className:"input",children:[(0,a.jsx)("option",{value:"",children:"N'importe quelle valeur"}),o.possibleValues.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}):(0,a.jsx)("input",{type:"text",value:e.fromValue||"",onChange:a=>t({...e,fromValue:a.target.value||void 0}),className:"input",placeholder:"N'importe quelle valeur"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Valeur Finale (Vers)"}),o.possibleValues?(0,a.jsxs)("select",{value:e.toValue||"",onChange:a=>t({...e,toValue:a.target.value||void 0}),className:"input",children:[(0,a.jsx)("option",{value:"",children:"N'importe quelle valeur"}),o.possibleValues.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}):(0,a.jsx)("input",{type:"text",value:e.toValue||"",onChange:a=>t({...e,toValue:a.target.value||void 0}),className:"input",placeholder:"Nouvelle valeur"})]})]})]})]})}let o=[{value:"equals",label:"Ã‰gal Ã "},{value:"not_equals",label:"DiffÃ©rent de"},{value:"contains",label:"Contient"},{value:"is_null",label:"Est vide"},{value:"is_not_null",label:"N'est pas vide"},{value:"greater_than",label:"SupÃ©rieur Ã "},{value:"less_than",label:"InfÃ©rieur Ã "}],u=[{value:"AND",label:"ET (toutes les conditions)"},{value:"OR",label:"OU (au moins une condition)"}];function m({conditionGroup:e,fields:s,onConditionGroupChange:l,onAddCondition:i,onUpdateCondition:n,onRemoveCondition:t}){return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"DÃ©finir les Conditions"}),(0,a.jsx)("p",{className:"text-secondary mb-4",children:"Ajoutez des conditions supplÃ©mentaires pour filtrer quand la rÃ¨gle doit s'appliquer. Les conditions sont optionnelles."})]}),e.conditions.length>1&&(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("label",{className:"label",children:"Logique de Combinaison"}),(0,a.jsx)("div",{className:"flex gap-4",children:u.map(s=>(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"logic",value:s.value,checked:e.logic===s.value,onChange:()=>{var a;return a=s.value,void l({...e,logic:a})}}),(0,a.jsx)("span",{children:s.label})]},s.value))})]}),(0,a.jsx)("div",{className:"space-y-3",children:e.conditions.map((e,l)=>{let i,r=(i=e.field,s.find(e=>e.name===i));return(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-secondary",children:["Condition ",l+1]}),(0,a.jsx)("button",{onClick:()=>t(e.id),className:"text-error hover:text-red-700 text-sm",children:"Supprimer"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Champ"}),(0,a.jsxs)("select",{value:e.field,onChange:a=>n(e.id,{field:a.target.value}),className:"input",children:[(0,a.jsx)("option",{value:"",children:"SÃ©lectionner..."}),s.map(e=>(0,a.jsx)("option",{value:e.name,children:e.label},e.name))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"OpÃ©rateur"}),(0,a.jsx)("select",{value:e.operator,onChange:a=>n(e.id,{operator:a.target.value}),className:"input",children:o.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),!["is_null","is_not_null"].includes(e.operator)&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Valeur"}),r?.possibleValues?(0,a.jsxs)("select",{value:e.value||"",onChange:a=>n(e.id,{value:a.target.value}),className:"input",children:[(0,a.jsx)("option",{value:"",children:"SÃ©lectionner..."}),r.possibleValues.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}):(0,a.jsx)("input",{type:"text",value:e.value||"",onChange:a=>n(e.id,{value:a.target.value}),className:"input",placeholder:"Valeur..."})]})]})]},e.id)})}),(0,a.jsx)("button",{onClick:()=>{i({id:`cond_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,field:"",operator:"equals",value:""})},className:"btn btn-outline w-full",children:"+ Ajouter une Condition"}),0===e.conditions.length&&(0,a.jsx)("div",{className:"text-center py-6 text-secondary bg-muted rounded-lg",children:"Aucune condition dÃ©finie. La rÃ¨gle s'appliquera Ã  chaque dÃ©clenchement."})]})}let p={email:"ðŸ“§ Email",sms:"ðŸ“± SMS",whatsapp:"ðŸ’¬ WhatsApp"},h={final_client:"Client Final",client_all:"Tous les Clients",staff:"Personnel",role:"Par RÃ´le",manual:"Manuel"},x={once:"Une fois",daily:"Quotidien",weekly:"Hebdomadaire",monthly:"Mensuel"};function v({selectedId:e,communications:l,isLoading:i,onSelect:n,onLoadCommunications:t}){(0,s.useEffect)(()=>{t()},[t]);let r=l.find(a=>a.id===e);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"SÃ©lectionner une Communication"}),(0,a.jsx)("p",{className:"text-secondary mb-4",children:"Choisissez la communication existante qui sera envoyÃ©e lorsque la rÃ¨gle se dÃ©clenche. Les communications sont dÃ©finies sÃ©parÃ©ment dans le Campaign Builder."})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("label",{className:"label",children:"Communication *"}),i&&0===l.length?(0,a.jsx)("div",{className:"text-secondary",children:"Chargement des communications..."}):(0,a.jsxs)("select",{value:e,onChange:e=>n(e.target.value),className:"input",children:[(0,a.jsx)("option",{value:"",children:"SÃ©lectionner une communication..."}),l.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),r&&(0,a.jsxs)("div",{className:"card p-4 bg-muted/50 border-2 border-primary/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-lg",children:r.name}),(0,a.jsx)("span",{className:"text-xs bg-primary/10 text-primary px-2 py-1 rounded",children:"Lecture seule"})]}),r.description&&(0,a.jsx)("p",{className:"text-secondary text-sm mb-4",children:r.description}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-secondary mb-1",children:"Canaux"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:r.channels.map(e=>(0,a.jsx)("span",{className:"px-2 py-1 bg-white rounded border text-xs",children:p[e]||e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-secondary mb-1",children:"Destinataires"}),(0,a.jsx)("div",{className:"font-medium",children:h[r.recipientType]||r.recipientType}),(0,a.jsx)("div",{className:"text-xs text-secondary",children:r.recipientDetails})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-secondary mb-1",children:"FrÃ©quence"}),(0,a.jsx)("div",{className:"font-medium",children:x[r.frequency]||r.frequency})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-secondary mb-1",children:"PiÃ¨ces Jointes"}),r.attachments.length>0?(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:r.attachments.map((e,s)=>(0,a.jsxs)("span",{className:"text-xs bg-white px-2 py-1 rounded border",children:["ðŸ“Ž ",e]},s))}):(0,a.jsx)("span",{className:"text-secondary",children:"Aucune"})]})]}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t",children:[(0,a.jsx)("div",{className:"text-secondary text-sm mb-1",children:"Sujet"}),(0,a.jsx)("div",{className:"font-medium",children:r.subject})]}),(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsx)("div",{className:"text-secondary text-sm mb-1",children:"AperÃ§u du Contenu"}),(0,a.jsx)("div",{className:"p-3 bg-white rounded border text-sm whitespace-pre-wrap",children:r.bodyPreview})]}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t text-xs text-secondary",children:["CrÃ©Ã©e le ",new Date(r.createdAt).toLocaleDateString("fr-FR")," par ",r.createdBy]})]}),!e&&l.length>0&&(0,a.jsx)("div",{className:"text-center py-8 text-secondary bg-muted rounded-lg",children:"SÃ©lectionnez une communication pour voir ses dÃ©tails."})]})}let b=[{value:"immediate",label:"ImmÃ©diat",description:"Envoyer dÃ¨s que l'Ã©vÃ©nement se produit"},{value:"delayed",label:"DiffÃ©rÃ©",description:"Envoyer aprÃ¨s un dÃ©lai dÃ©fini"},{value:"daily",label:"Quotidien",description:"Envoyer tous les jours Ã  une heure fixe"},{value:"monthly",label:"Mensuel",description:"Envoyer chaque mois Ã  une date fixe"},{value:"cron",label:"Expression Cron",description:"Planification personnalisÃ©e avec cron"}],j=[{label:"Tous les jours Ã  9h",value:"0 9 * * *"},{label:"Tous les lundis Ã  9h",value:"0 9 * * 1"},{label:"Le 1er du mois Ã  9h",value:"0 9 1 * *"},{label:"Toutes les heures",value:"0 * * * *"}],g=[{value:5,label:"5 minutes"},{value:15,label:"15 minutes"},{value:30,label:"30 minutes"},{value:60,label:"1 heure"},{value:120,label:"2 heures"},{value:1440,label:"24 heures"}];function f({schedule:e,onScheduleChange:s}){return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Planifier l'Envoi"}),(0,a.jsx)("p",{className:"text-secondary mb-4",children:"DÃ©finissez quand la communication doit Ãªtre envoyÃ©e aprÃ¨s le dÃ©clenchement de la rÃ¨gle."})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("label",{className:"label",children:"Type de Planification *"}),(0,a.jsx)("div",{className:"space-y-2",children:b.map(l=>(0,a.jsxs)("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-colors ${e.type===l.value?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,children:[(0,a.jsx)("input",{type:"radio",name:"scheduleType",value:l.value,checked:e.type===l.value,onChange:()=>{var a;return a=l.value,void s({...e,type:a,delayMinutes:"delayed"===a?e.delayMinutes||15:void 0,scheduledTime:["daily","monthly"].includes(a)?e.scheduledTime||"09:00":void 0,dayOfMonth:"monthly"===a?e.dayOfMonth||1:void 0,cronExpression:"cron"===a?e.cronExpression:void 0})},className:"mt-1"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:l.label}),(0,a.jsx)("div",{className:"text-sm text-secondary",children:l.description})]})]},l.value))})]}),"delayed"===e.type&&(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("label",{className:"label",children:"DÃ©lai avant Envoi *"}),(0,a.jsx)("select",{value:e.delayMinutes||15,onChange:a=>s({...e,delayMinutes:Number(a.target.value)}),className:"input",children:g.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,a.jsx)("p",{className:"text-xs text-secondary mt-1",children:"La communication sera envoyÃ©e aprÃ¨s ce dÃ©lai suivant le dÃ©clenchement."})]}),"daily"===e.type&&(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("label",{className:"label",children:"Heure d'Envoi Quotidien *"}),(0,a.jsx)("input",{type:"time",value:e.scheduledTime||"09:00",onChange:a=>s({...e,scheduledTime:a.target.value}),className:"input"}),(0,a.jsx)("p",{className:"text-xs text-secondary mt-1",children:"La communication sera envoyÃ©e tous les jours Ã  cette heure."})]}),"monthly"===e.type&&(0,a.jsxs)("div",{className:"card p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Jour du Mois *"}),(0,a.jsx)("select",{value:e.dayOfMonth||1,onChange:a=>s({...e,dayOfMonth:Number(a.target.value)}),className:"input",children:Array.from({length:28},(e,a)=>a+1).map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Heure d'Envoi *"}),(0,a.jsx)("input",{type:"time",value:e.scheduledTime||"09:00",onChange:a=>s({...e,scheduledTime:a.target.value}),className:"input"})]})]}),"cron"===e.type&&(0,a.jsxs)("div",{className:"card p-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Expression Cron *"}),(0,a.jsx)("input",{type:"text",value:e.cronExpression||"",onChange:a=>s({...e,cronExpression:a.target.value}),placeholder:"0 9 * * *",className:"input font-mono"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-secondary mb-2",children:"PrÃ©rÃ©glages Rapides :"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:j.map(l=>(0,a.jsx)("button",{onClick:()=>s({...e,cronExpression:l.value}),className:"btn btn-outline text-sm py-1",children:l.label},l.value))})]})]}),(0,a.jsxs)("div",{className:"text-sm text-secondary",children:["Fuseau Horaire : ",(0,a.jsx)("strong",{children:e.timezone})]})]})}let y={on_create:"Ã€ la crÃ©ation",on_update:"Ã€ la modification"},N={immediate:"ImmÃ©diat",delayed:"DiffÃ©rÃ©",daily:"Quotidien",monthly:"Mensuel",cron:"Expression Cron"},C={equals:"=",not_equals:"â‰ ",contains:"contient",is_null:"est vide",is_not_null:"n'est pas vide",greater_than:">",less_than:"<"},T={email:"ðŸ“§ Email",sms:"ðŸ“± SMS",whatsapp:"ðŸ’¬ WhatsApp"};function S({draft:e,tables:s,fields:l,communication:i}){let n=s.find(a=>a.name===e.trigger.tableName)?.label||e.trigger.tableName,t=e=>l.find(a=>a.name===e)?.label||e;return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"RÃ©sumÃ© de la RÃ¨gle"}),(0,a.jsx)("p",{className:"text-secondary mb-4",children:"VÃ©rifiez tous les paramÃ¨tres avant de crÃ©er la rÃ¨gle automatique."})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-secondary mb-2",children:"Informations GÃ©nÃ©rales"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Nom :"})," ",e.name||"Non dÃ©fini"]}),e.description&&(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Description :"})," ",e.description]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Statut :"})," ",e.isActive?"âœ… Active":"â¸ï¸ Inactive"]})]})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-secondary mb-2",children:"ðŸŽ¯ DÃ©clencheur"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Table :"})," ",n]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Ã‰vÃ©nement :"})," ",y[e.trigger.event]]}),e.trigger.fieldName&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Champ :"})," ",t(e.trigger.fieldName)]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Transition :"})," ",e.trigger.fromValue||"N'importe quelle valeur"," â†’ ",e.trigger.toValue||"N'importe quelle valeur"]})]})]})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-secondary mb-2",children:"ðŸ” Conditions"}),e.conditionGroup.conditions.length>0?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("p",{className:"text-sm",children:["Logique : ",(0,a.jsx)("strong",{children:e.conditionGroup.logic})]}),e.conditionGroup.conditions.map(e=>(0,a.jsxs)("div",{className:"p-2 bg-muted rounded text-sm",children:[t(e.field)," ",C[e.operator]," ",e.value||""]},e.id))]}):(0,a.jsx)("p",{className:"text-secondary text-sm",children:"Aucune condition (toujours dÃ©clenchÃ©)"})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-secondary mb-2",children:"ðŸ“¨ Communication LiÃ©e"}),i?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{children:(0,a.jsx)("strong",{children:i.name})}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:i.channels.map(e=>(0,a.jsx)("span",{className:"px-2 py-1 bg-muted rounded text-xs",children:T[e]||e},e))}),(0,a.jsxs)("p",{className:"text-sm text-secondary",children:["Sujet : ",i.subject]}),i.attachments.length>0&&(0,a.jsxs)("p",{className:"text-sm text-secondary",children:["PiÃ¨ces jointes : ",i.attachments.join(", ")]})]}):(0,a.jsx)("p",{className:"text-error text-sm",children:"Aucune communication sÃ©lectionnÃ©e"})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("h4",{className:"font-medium text-secondary mb-2",children:"ðŸ“… Planification"}),(0,a.jsxs)("p",{children:[(0,a.jsx)("strong",{children:"Type :"})," ",N[e.schedule.type]]}),e.schedule.delayMinutes&&(0,a.jsxs)("p",{className:"text-sm mt-1",children:["DÃ©lai : ",e.schedule.delayMinutes," minutes"]}),e.schedule.scheduledTime&&(0,a.jsxs)("p",{className:"text-sm mt-1",children:["Heure : ",e.schedule.scheduledTime]}),e.schedule.dayOfMonth&&(0,a.jsxs)("p",{className:"text-sm mt-1",children:["Jour du mois : ",e.schedule.dayOfMonth]}),e.schedule.cronExpression&&(0,a.jsxs)("p",{className:"text-sm mt-1 font-mono",children:["Cron : ",e.schedule.cronExpression]}),(0,a.jsxs)("p",{className:"text-sm mt-1",children:["Fuseau : ",e.schedule.timezone]})]})]})}function A({onComplete:e,onCancel:i}){let c=function(){let[e,a]=(0,s.useState)("trigger"),[i,t]=(0,s.useState)(n),r=(0,s.useMemo)(()=>l.indexOf(e),[e]),c=0===r,d=r===l.length-1,o=(0,s.useCallback)(()=>{d||a(l[r+1])},[r,d]),u=(0,s.useCallback)(()=>{c||a(l[r-1])},[r,c]),m=(0,s.useCallback)(e=>{a(e)},[]),p=(0,s.useCallback)(e=>{t(a=>({...a,name:e}))},[]),h=(0,s.useCallback)(e=>{t(a=>({...a,description:e}))},[]),x=(0,s.useCallback)(e=>{t(a=>({...a,trigger:e}))},[]),v=(0,s.useCallback)(e=>{t(a=>({...a,conditionGroup:e}))},[]),b=(0,s.useCallback)(e=>{t(a=>({...a,conditionGroup:{...a.conditionGroup,conditions:[...a.conditionGroup.conditions,e]}}))},[]),j=(0,s.useCallback)((e,a)=>{t(s=>({...s,conditionGroup:{...s.conditionGroup,conditions:s.conditionGroup.conditions.map(s=>s.id===e?{...s,...a}:s)}}))},[]),g=(0,s.useCallback)(e=>{t(a=>({...a,conditionGroup:{...a.conditionGroup,conditions:a.conditionGroup.conditions.filter(a=>a.id!==e)}}))},[]),f=(0,s.useCallback)(e=>{t(a=>({...a,communicationId:e}))},[]);return{currentStep:e,draft:i,isFirstStep:c,isLastStep:d,nextStep:o,prevStep:u,goToStep:m,setName:p,setDescription:h,setTrigger:x,setConditionGroup:v,addCondition:b,updateCondition:j,removeCondition:g,setCommunicationId:f,setSchedule:(0,s.useCallback)(e=>{t(a=>({...a,schedule:e}))},[]),resetDraft:(0,s.useCallback)(()=>{t(n()),a("trigger")},[])}}(),o=function(){let[e,a]=(0,s.useState)([]),[l,i]=(0,s.useState)([]),[n,r]=(0,s.useState)([]),[c,d]=(0,s.useState)(!1),[o,u]=(0,s.useState)(!1),[m,p]=(0,s.useState)([]),h=(0,s.useCallback)(async()=>{d(!0);try{let e=await (0,t.fetchAvailableTables)();a(e)}catch(e){console.error("Failed to load tables:",e)}finally{d(!1)}},[]),x=(0,s.useCallback)(async e=>{if(!e)return void i([]);d(!0);try{let a=await (0,t.fetchTableFields)(e);i(a)}catch(e){console.error("Failed to load fields:",e)}finally{d(!1)}},[]),v=(0,s.useCallback)(async()=>{d(!0);try{let e=await (0,t.fetchCommunications)();r(e)}catch(e){console.error("Failed to load communications:",e)}finally{d(!1)}},[]),b=(0,s.useCallback)(async e=>{let a=await (0,t.validateRule)(e);return p(a),0===a.length},[]),j=(0,s.useCallback)(async e=>{if(p([]),!await b(e))return null;u(!0);try{return(await (0,t.createRule)(e)).id}catch(e){return console.error("Failed to create rule:",e),p(["Ã‰chec de la crÃ©ation de la rÃ¨gle. Veuillez rÃ©essayer."]),null}finally{u(!1)}},[b]),g=(0,s.useCallback)(()=>{p([])},[]),f=(0,s.useCallback)(e=>n.find(a=>a.id===e),[n]);return{tables:e,fields:l,communications:n,isLoading:c,isSending:o,errors:m,loadTables:h,loadFields:x,loadCommunications:v,validate:b,submit:j,clearErrors:g,getCommunicationById:f}}(),u=async()=>{let a=await o.submit(c.draft);a&&e(a)};return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsx)(r,{currentStep:c.currentStep,onStepClick:c.goToStep}),"trigger"===c.currentStep&&(0,a.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Nom de la RÃ¨gle *"}),(0,a.jsx)("input",{type:"text",value:c.draft.name,onChange:e=>c.setName(e.target.value),className:"input",placeholder:"Ex: Notification livraison planifiÃ©e"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Description"}),(0,a.jsx)("textarea",{value:c.draft.description,onChange:e=>c.setDescription(e.target.value),className:"input min-h-[60px]",placeholder:"Description optionnelle..."})]})]}),o.errors.length>0&&(0,a.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,a.jsx)("ul",{className:"list-disc list-inside text-error text-sm",children:o.errors.map((e,s)=>(0,a.jsx)("li",{children:e},s))})}),(0,a.jsx)("div",{className:"card p-6 mb-6",children:(()=>{switch(c.currentStep){case"trigger":return(0,a.jsx)(d,{trigger:c.draft.trigger,tables:o.tables,fields:o.fields,isLoading:o.isLoading,onTriggerChange:c.setTrigger,onLoadTables:o.loadTables,onLoadFields:o.loadFields});case"conditions":return(0,a.jsx)(m,{conditionGroup:c.draft.conditionGroup,fields:o.fields,onConditionGroupChange:c.setConditionGroup,onAddCondition:c.addCondition,onUpdateCondition:c.updateCondition,onRemoveCondition:c.removeCondition});case"communication":return(0,a.jsx)(v,{selectedId:c.draft.communicationId,communications:o.communications,isLoading:o.isLoading,onSelect:c.setCommunicationId,onLoadCommunications:o.loadCommunications});case"schedule":return(0,a.jsx)(f,{schedule:c.draft.schedule,onScheduleChange:c.setSchedule});case"summary":return(0,a.jsx)(S,{draft:c.draft,tables:o.tables,fields:o.fields,communication:o.getCommunicationById(c.draft.communicationId)});default:return null}})()}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("div",{children:c.isFirstStep?(0,a.jsx)("button",{onClick:i,className:"btn btn-secondary",children:"Annuler"}):(0,a.jsx)("button",{onClick:c.prevStep,className:"btn btn-secondary",children:"PrÃ©cÃ©dent"})}),(0,a.jsx)("div",{children:c.isLastStep?(0,a.jsx)("button",{onClick:u,disabled:o.isSending,className:"btn btn-primary",children:o.isSending?"CrÃ©ation...":"CrÃ©er la RÃ¨gle"}):(0,a.jsx)("button",{onClick:c.nextStep,className:"btn btn-primary",children:"Suivant"})})]})]})}e.s(["RulesWizard",()=>A],40214)},75610,e=>{"use strict";var a=e.i(43476),s=e.i(71645),l=e.i(18566),i=e.i(22016),n=e.i(3285),t=e.i(40214);function r(){let e=(0,l.useParams)(),r=(0,l.useRouter)(),[c,d]=(0,s.useState)(null),[o,u]=(0,s.useState)(!0),m=e.id;return((0,s.useEffect)(()=>{!async function(){u(!0),d(await (0,n.getRuleById)(m)),u(!1)}()},[m]),o)?(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"text-secondary",children:"Chargement..."})}):c?(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"flex items-center gap-3 mb-2",children:(0,a.jsx)(i.default,{href:`/automatic-rules/${m}`,className:"text-secondary hover:text-primary",children:"â† Retour aux dÃ©tails"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Modifier la RÃ¨gle"}),(0,a.jsxs)("p",{className:"text-secondary",children:['Modifiez les paramÃ¨tres de la rÃ¨gle "',c.name,'".']})]}),(0,a.jsx)(t.RulesWizard,{onComplete:e=>{console.log("Rule updated:",e),r.push(`/automatic-rules/${m}`)},onCancel:()=>{r.push(`/automatic-rules/${m}`)}})]}):(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"card p-8 text-center",children:[(0,a.jsx)("div",{className:"text-4xl mb-4",children:"âŒ"}),(0,a.jsx)("h2",{className:"text-xl font-bold mb-2",children:"RÃ¨gle non trouvÃ©e"}),(0,a.jsx)(i.default,{href:"/automatic-rules",className:"btn btn-primary mt-4",children:"Retour Ã  la liste"})]})})}e.s(["EditRuleClient",()=>r])}]);