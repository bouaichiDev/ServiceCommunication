(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,3285,e=>{"use strict";let t=[{name:"OT",label:"Ordre de Travail",description:"Table principale des ordres de travail"},{name:"OTDetail",label:"DÃ©tail OT",description:"Lignes de dÃ©tail des ordres de travail"},{name:"OT_Packages",label:"Colis OT",description:"Colis associÃ©s aux ordres de travail"},{name:"PLANS",label:"Plans",description:"Planification des livraisons"},{name:"CLIENTS",label:"Clients",description:"Table des clients"},{name:"STAFF",label:"Personnel",description:"Table du personnel"}],i={OT:[{name:"status",label:"Statut",type:"string",possibleValues:["DRAFT","PLANNED","IN_PROGRESS","DELIVERED","CANCELLED"]},{name:"delivery_date",label:"Date de livraison",type:"date"},{name:"client_id",label:"ID Client",type:"string"},{name:"priority",label:"PrioritÃ©",type:"number"},{name:"is_urgent",label:"Urgent",type:"boolean"}],OTDetail:[{name:"quantity",label:"QuantitÃ©",type:"number"},{name:"product_code",label:"Code Produit",type:"string"},{name:"status",label:"Statut",type:"string",possibleValues:["PENDING","PICKED","PACKED"]}],OT_Packages:[{name:"package_status",label:"Statut Colis",type:"string",possibleValues:["CREATED","SHIPPED","DELIVERED"]},{name:"weight",label:"Poids",type:"number"},{name:"tracking_number",label:"NumÃ©ro de suivi",type:"string"}],PLANS:[{name:"plan_date",label:"Date du plan",type:"date"},{name:"driver_id",label:"ID Chauffeur",type:"string"},{name:"status",label:"Statut",type:"string",possibleValues:["DRAFT","CONFIRMED","COMPLETED"]}],CLIENTS:[{name:"name",label:"Nom",type:"string"},{name:"email",label:"Email",type:"string"},{name:"is_active",label:"Actif",type:"boolean"}],STAFF:[{name:"name",label:"Nom",type:"string"},{name:"role",label:"RÃ´le",type:"string"},{name:"email",label:"Email",type:"string"}]},a=[{id:"comm1",name:"Notification Livraison PlanifiÃ©e",description:"Informe le client que sa livraison est planifiÃ©e",channels:["email","sms"],recipientType:"final_client",recipientDetails:"Client final liÃ© Ã  l'OT",frequency:"once",subject:"Votre livraison est planifiÃ©e",bodyPreview:"Bonjour {{client_name}}, votre commande sera livrÃ©e le {{delivery_date}}...",attachments:["Bon de livraison"],createdAt:"2024-01-10T09:00:00Z",createdBy:"Jean Directeur"},{id:"comm2",name:"Confirmation de Livraison",description:"Confirme que la livraison a Ã©tÃ© effectuÃ©e",channels:["email"],recipientType:"final_client",recipientDetails:"Client final liÃ© Ã  l'OT",frequency:"once",subject:"Livraison effectuÃ©e",bodyPreview:"Bonjour {{client_name}}, votre commande a Ã©tÃ© livrÃ©e avec succÃ¨s...",attachments:["Preuve de livraison","Facture"],createdAt:"2024-01-12T14:00:00Z",createdBy:"Marie Admin"},{id:"comm3",name:"Alerte Retard Livraison",description:"Alerte le gestionnaire en cas de retard",channels:["email","whatsapp"],recipientType:"role",recipientDetails:"Gestionnaires",frequency:"once",subject:"Alerte: Retard de livraison",bodyPreview:"Attention, l'OT {{ot_id}} est en retard de livraison...",attachments:[],createdAt:"2024-01-15T10:00:00Z",createdBy:"Admin SystÃ¨me"},{id:"comm4",name:"Rapport Quotidien",description:"Rapport quotidien des opÃ©rations",channels:["email"],recipientType:"staff",recipientDetails:"Tout le personnel",frequency:"daily",subject:"Rapport du {{date}}",bodyPreview:"Voici le rÃ©sumÃ© des opÃ©rations du jour...",attachments:["Rapport PDF"],createdAt:"2024-01-08T08:00:00Z",createdBy:"Jean Directeur"}];async function s(){return await new Promise(e=>setTimeout(e,300)),t}async function n(e){return await new Promise(e=>setTimeout(e,300)),i[e]||[]}async function l(){return await new Promise(e=>setTimeout(e,400)),a}async function r(e){return await new Promise(e=>setTimeout(e,800)),console.log("Creating automatic rule:",JSON.stringify(e,null,2)),{id:Date.now().toString()}}async function c(e){let t=[];return e.name.trim()||t.push("Le nom de la rÃ¨gle est requis"),e.trigger.tableName||t.push("SÃ©lectionnez une table source"),e.trigger.event||t.push("SÃ©lectionnez un type d'Ã©vÃ©nement"),e.communicationId||t.push("SÃ©lectionnez une communication"),t}let o=[{id:"rule1",name:"Notification OT PlanifiÃ©",isActive:!0,trigger:{table:"OT",event:"update",field:"status",fromValue:"DRAFT",toValue:"PLANNED"},linkedCommunication:{id:"comm1",name:"Notification Livraison PlanifiÃ©e",channels:["email","sms"]},schedule:{type:"immediate"},createdAt:"2024-01-15T10:00:00Z"},{id:"rule2",name:"Confirmation Livraison EffectuÃ©e",isActive:!0,trigger:{table:"OT",event:"update",field:"status",toValue:"DELIVERED"},linkedCommunication:{id:"comm2",name:"Confirmation de Livraison",channels:["email"]},schedule:{type:"delayed",expression:"15 min"},createdAt:"2024-01-16T14:00:00Z"},{id:"rule3",name:"Alerte Colis ExpÃ©diÃ©",isActive:!1,trigger:{table:"OT_Packages",event:"update",field:"package_status",toValue:"SHIPPED"},linkedCommunication:{id:"comm1",name:"Notification Livraison PlanifiÃ©e",channels:["email","sms"]},schedule:{type:"immediate"},createdAt:"2024-01-17T09:00:00Z"},{id:"rule4",name:"Rapport Quotidien Automatique",isActive:!0,trigger:{table:"PLANS",event:"create"},linkedCommunication:{id:"comm4",name:"Rapport Quotidien",channels:["email"]},schedule:{type:"cron",expression:"0 18 * * *"},createdAt:"2024-01-10T08:00:00Z"},{id:"rule5",name:"Alerte Retard Livraison",isActive:!0,trigger:{table:"OT",event:"update",field:"status",toValue:"CANCELLED"},linkedCommunication:{id:"comm3",name:"Alerte Retard Livraison",channels:["email","whatsapp"]},schedule:{type:"immediate"},createdAt:"2024-01-18T11:00:00Z"}];async function d(){return await new Promise(e=>setTimeout(e,400)),[...o]}async function m(e){await new Promise(e=>setTimeout(e,300));let t=o.find(t=>t.id===e);if(!t)throw Error("Rule not found");return t.isActive=!t.isActive,{...t}}async function u(e){await new Promise(e=>setTimeout(e,300));let t=o.findIndex(t=>t.id===e);-1!==t&&o.splice(t,1)}async function p(e){return await new Promise(e=>setTimeout(e,300)),o.find(t=>t.id===e)||null}e.s(["createRule",()=>r,"deleteRule",()=>u,"fetchAvailableTables",()=>s,"fetchCommunications",()=>l,"fetchTableFields",()=>n,"getRuleById",()=>p,"getRules",()=>d,"toggleRuleStatus",()=>m,"validateRule",()=>c])},54635,e=>{"use strict";var t=e.i(43476);function i({isActive:e}){return(0,t.jsxs)("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium ${e?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:[(0,t.jsx)("span",{className:`w-2 h-2 rounded-full ${e?"bg-green-500":"bg-gray-400"}`}),e?"Active":"Inactive"]})}e.s(["RuleStatusBadge",()=>i])},69138,e=>{"use strict";var t=e.i(43476),i=e.i(22016),a=e.i(18566),s=e.i(71645),n=e.i(3285),l=e.i(54635);function r({ruleId:e,isActive:i,onView:a,onToggleStatus:n,onEdit:l,onDelete:r}){let[c,o]=(0,s.useState)(!1),d=e=>{e(),o(!1)};return(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("button",{onClick:()=>o(!c),className:"p-2 hover:bg-muted rounded-lg transition-colors",children:(0,t.jsx)("span",{className:"text-lg",children:"â‹®"})}),c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>o(!1)}),(0,t.jsxs)("div",{className:"absolute right-0 top-full mt-1 w-48 bg-card border border-border rounded-lg shadow-lg z-20",children:[(0,t.jsx)("button",{onClick:()=>d(()=>a(e)),className:"w-full px-4 py-2 text-left text-sm hover:bg-muted transition-colors flex items-center gap-2",children:"ðŸ‘ï¸ Voir les dÃ©tails"}),(0,t.jsx)("button",{onClick:()=>d(()=>n(e)),className:"w-full px-4 py-2 text-left text-sm hover:bg-muted transition-colors flex items-center gap-2",children:i?"â¸ï¸ DÃ©sactiver":"â–¶ï¸ Activer"}),(0,t.jsx)("button",{onClick:()=>d(()=>l(e)),className:"w-full px-4 py-2 text-left text-sm hover:bg-muted transition-colors flex items-center gap-2",children:"âœï¸ Modifier"}),(0,t.jsx)("hr",{className:"border-border"}),(0,t.jsx)("button",{onClick:()=>d(()=>r(e)),className:"w-full px-4 py-2 text-left text-sm text-error hover:bg-red-50 transition-colors flex items-center gap-2",children:"ðŸ—‘ï¸ Supprimer"})]})]})]})}let c={email:"ðŸ“§",sms:"ðŸ“±",whatsapp:"ðŸ’¬"},o={immediate:"ImmÃ©diat",delayed:"DiffÃ©rÃ©",cron:"PlanifiÃ©"};function d({rules:e,isLoading:i,onView:a,onToggleStatus:s,onEdit:n,onDelete:d}){return i?(0,t.jsx)("div",{className:"card p-8 text-center text-secondary",children:"Chargement des rÃ¨gles..."}):0===e.length?(0,t.jsxs)("div",{className:"card p-8 text-center",children:[(0,t.jsx)("div",{className:"text-4xl mb-4",children:"âš¡"}),(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Aucune rÃ¨gle automatique"}),(0,t.jsx)("p",{className:"text-secondary",children:"CrÃ©ez votre premiÃ¨re rÃ¨gle pour automatiser l'envoi de communications."})]}):(0,t.jsx)("div",{className:"card overflow-hidden",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-muted",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-secondary",children:"Nom de la RÃ¨gle"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-secondary",children:"DÃ©clencheur"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-secondary",children:"Communication"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-secondary",children:"Planification"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-sm font-medium text-secondary",children:"Statut"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right text-sm font-medium text-secondary",children:"Actions"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-border",children:e.map(e=>{var i;let m,u;return(0,t.jsxs)("tr",{className:"hover:bg-muted/50 transition-colors",children:[(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"font-medium",children:e.name}),(0,t.jsxs)("div",{className:"text-xs text-secondary",children:["CrÃ©Ã©e le ",new Date(e.createdAt).toLocaleDateString("fr-FR")]})]}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)("div",{className:"text-sm",children:(m="create"===(i=e.trigger).event?"CrÃ©ation":"Modification",u=`${i.table} â€¢ ${m}`,i.field&&(u+=` â€¢ ${i.field}`,(i.fromValue||i.toValue)&&(u+=`: ${i.fromValue||"*"} â†’ ${i.toValue||"*"}`)),u)})}),(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"text-sm font-medium",children:e.linkedCommunication.name}),(0,t.jsx)("div",{className:"flex gap-1 mt-1",children:e.linkedCommunication.channels.map(e=>(0,t.jsx)("span",{title:e,className:"text-sm",children:c[e]||e},e))})]}),(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"text-sm",children:o[e.schedule.type]||e.schedule.type}),e.schedule.expression&&(0,t.jsx)("div",{className:"text-xs text-secondary font-mono",children:e.schedule.expression})]}),(0,t.jsx)("td",{className:"px-4 py-3",children:(0,t.jsx)(l.RuleStatusBadge,{isActive:e.isActive})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right",children:(0,t.jsx)(r,{ruleId:e.id,isActive:e.isActive,onView:a,onToggleStatus:s,onEdit:n,onDelete:d})})]},e.id)})})]})})}function m(){let e=(0,a.useRouter)(),{rules:l,isLoading:r,error:c,activeCount:o,inactiveCount:m,handleToggleStatus:u,handleDelete:p,clearError:x}=function(){let[e,t]=(0,s.useState)([]),[i,a]=(0,s.useState)(!1),[l,r]=(0,s.useState)(null),c=(0,s.useCallback)(async()=>{a(!0),r(null);try{let e=await (0,n.getRules)();t(e)}catch(e){console.error("Failed to load rules:",e),r("Ã‰chec du chargement des rÃ¨gles")}finally{a(!1)}},[]);(0,s.useEffect)(()=>{c()},[c]);let o=(0,s.useCallback)(async e=>{try{let i=await (0,n.toggleRuleStatus)(e);t(t=>t.map(t=>t.id===e?i:t))}catch(e){console.error("Failed to toggle rule status:",e),r("Ã‰chec de la modification du statut")}},[]),d=(0,s.useCallback)(async e=>{try{await (0,n.deleteRule)(e),t(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Failed to delete rule:",e),r("Ã‰chec de la suppression de la rÃ¨gle")}},[]),m=(0,s.useCallback)(()=>{r(null)},[]),u=e.filter(e=>e.isActive).length,p=e.filter(e=>!e.isActive).length;return{rules:e,isLoading:i,error:l,activeCount:u,inactiveCount:p,loadRules:c,handleToggleStatus:o,handleDelete:d,clearError:m}}();return(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"RÃ¨gles Automatiques"}),(0,t.jsx)("p",{className:"text-secondary",children:"GÃ©rez les rÃ¨gles qui dÃ©clenchent automatiquement l'envoi de communications."})]}),(0,t.jsx)(i.default,{href:"/automatic-rules/new",className:"btn btn-primary",children:"+ Nouvelle RÃ¨gle"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"card p-4",children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:l.length}),(0,t.jsx)("div",{className:"text-sm text-secondary",children:"Total des rÃ¨gles"})]}),(0,t.jsxs)("div",{className:"card p-4",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:o}),(0,t.jsx)("div",{className:"text-sm text-secondary",children:"RÃ¨gles actives"})]}),(0,t.jsxs)("div",{className:"card p-4",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-gray-500",children:m}),(0,t.jsx)("div",{className:"text-sm text-secondary",children:"RÃ¨gles inactives"})]})]}),c&&(0,t.jsxs)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-error",children:c}),(0,t.jsx)("button",{onClick:x,className:"text-error hover:text-red-700",children:"âœ•"})]}),(0,t.jsx)(d,{rules:l,isLoading:r,onView:t=>{e.push(`/automatic-rules/${t}`)},onToggleStatus:u,onEdit:t=>{e.push(`/automatic-rules/${t}/edit`)},onDelete:p})]})}e.s(["default",()=>m],69138)}]);